# Number of Inngest application replicas
replicaCount: 1

image:
  repository: inngest/inngest
  pullPolicy: IfNotPresent
  tag: "latest"   # ⚠️ In prod: pin to a specific version

namespace:
  create: true
  name: "inngest"

serviceAccount:
  create: true
  annotations: {}
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

service:
  type: ClusterIP
  port: 8288
  connPort: 8289

# ✅ AWS ALB ingress configuration
ingress:
  enabled: true
  className: "alb"
  annotations:
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP":80},{"HTTPS":443}]'
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:ap-south-1:123456789012:certificate/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
    alb.ingress.kubernetes.io/load-balancer-arn: arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/app/k8s-argocd-argocdse-c5d356d97e/1114360161  # <--- Add this
    alb.ingress.kubernetes.io/actions.ssl-redirect: >
      {"Type": "redirect", "RedirectConfig": { "Protocol": "HTTPS", "Port": "443", "StatusCode": "HTTP_301"}}
  hosts:
    - host: devopslogs.com
      paths:
        - path: /inngest/*
          pathType: Prefix
  tls:
    - secretName: inngest-tls
      hosts:
        - devopslogs.com


resources: {}

nodeSelector: {}
tolerations: []
affinity: {}

# ✅ Inngest configuration
inngest:
  eventKey: "abcd1234abcd1234abcd1234abcd1234"
  signingKey: "efgh5678efgh5678efgh5678efgh5678"
  config: ""
  host: ""
  port: "8288"
  sdkUrl: []
  connectGatewayPort: 8289
  noUI: false
  pollInterval: 60
  queueWorkers: 100
  retryInterval: 1
  tick: 150
  json: false
  logLevel: "info"
  verbose: false
  postgres:
    uri: ""   # leave blank, using internal postgres
  redis:
    uri: ""   # leave blank, using internal redis
  sqlite:
    dir: ""

# ✅ Internal PostgreSQL
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: "17"
    pullPolicy: IfNotPresent
  auth:
    database: inngest
    username: inngest
    password: secure_password   # ⚠️ change in production
  service:
    port: 5432
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 256Mi
  persistence:
    enabled: true
    size: 8Gi
    storageClass: ""
    accessModes:
      - ReadWriteOnce

# ✅ Internal Redis
redis:
  enabled: true
  image:
    repository: redis
    tag: "7-alpine"
    pullPolicy: IfNotPresent
  service:
    port: 6379
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  persistence:
    enabled: true
    size: 8Gi
    storageClass: ""
    accessModes:
      - ReadWriteOnce

keda:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  pollingInterval: 30
  cooldownPeriod: 300
  scaleTargetRef:
    name: inngest
  triggers:
    - type: prometheus
      metadata:
        metricName: inngest_queue_depth
        threshold: "10"
        query: inngest_queue_depth

networkPolicy:
  enabled: false
  ingress: []
  egress: []

prometheus:
  image:
    repository: prom/prometheus
    tag: "v2.45.0"
    pullPolicy: IfNotPresent
  scrapeInterval: "15s"
  evaluationInterval: "15s"
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi
